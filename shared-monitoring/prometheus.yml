global:
  scrape_interval: 15s
  evaluation_interval: 15s

# AlertManager configuration
alerting:
  alertmanagers:
    - static_configs:
        - targets:
            - alertmanager-shared:9093

# Load rules once and periodically evaluate them
rule_files:
  - "/etc/prometheus/rules/*.yml"

scrape_configs:
  # Prometheus itself
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']

  # AlertManager
  - job_name: 'alertmanager'
    static_configs:
      - targets: ['tas-alertmanager-shared:9093']
    metrics_path: '/metrics'
    scrape_interval: 30s

  # OpenTelemetry Collector
  - job_name: 'otel-collector'
    static_configs:
      - targets: ['tas-otel-collector-shared:8888']
    metrics_path: '/metrics'
    scrape_interval: 30s

  # AudiModal (Prometheus formatted metrics)
  - job_name: 'audimodal'
    static_configs:
      - targets: ['audimodal-app:8080']  # Main API port
    metrics_path: '/metrics/prometheus'  # Prometheus formatted endpoint
    scrape_interval: 10s

  # LLM Router WAF
  - job_name: 'llm-router'
    static_configs:
      - targets: ['llm-router-aether-app:8080']
    metrics_path: '/metrics'
    scrape_interval: 15s
    scrape_timeout: 10s
    relabel_configs:
      - source_labels: [__address__]
        target_label: instance
        replacement: 'llm-router-aether'
      - source_labels: [__address__]
        target_label: service
        replacement: 'llm-router'

  # Add other services when they're actually running and exposing metrics
  # Uncomment these when the services are deployed with metrics endpoints:
  
  # # Aether Backend
  # - job_name: 'aether-backend'
  #   static_configs:
  #     - targets: ['aether-backend:8081']
  #   metrics_path: '/metrics'
  #   scrape_interval: 30s

  # # DeepLake API  
  # - job_name: 'deeplake-service'
  #   static_configs:
  #     - targets: ['deeplake-service:9091']
  #   metrics_path: '/metrics'
  #   scrape_interval: 30s

  # # TAS MCP
  # - job_name: 'tas-mcp-server'
  #   static_configs:
  #     - targets: ['tas-mcp-server:8083']
  #   metrics_path: '/metrics'
  #   scrape_interval: 30s